name: Publish to Comfy Registry
on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘é€‰é¡¹
  push:
    branches:
      - main
    paths:
      - "pyproject.toml"

jobs:
  publish-node:
    name: Publish Custom Node to registry
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4
      
      - name: Display Version Info
        run: |
          echo "æ£€æµ‹åˆ° pyproject.toml æ›´æ–°ï¼Œæ­£åœ¨å‡†å¤‡å‘å¸ƒ..."
          VERSION=$(grep '^version' pyproject.toml | cut -d '"' -f 2)
          NAME=$(grep '^name' pyproject.toml | cut -d '"' -f 2)
          echo "ğŸ“¦ æ’ä»¶åç§°: $NAME"
          echo "ğŸ”– ç‰ˆæœ¬å·: $VERSION"
          echo ""
          echo "å¼€å§‹å‘å¸ƒåˆ° ComfyUI Registry..."
      
      - name: Publish Custom Node
        id: publish
        uses: Comfy-Org/publish-node-action@main
        with:
          personal_access_token: ${{ secrets.REGISTRY_ACCESS_TOKEN }}
        
      - name: Success Notification
        if: success()
        run: |
          echo "========================================"
          echo "ğŸš€ è‡ªåŠ¨å‘å¸ƒæˆåŠŸ!"
          echo "========================================"
          echo ""
          echo "âœ… æ’ä»¶å·²æˆåŠŸå‘å¸ƒåˆ° ComfyUI Registry"
          echo ""
          VERSION=$(grep '^version' pyproject.toml | cut -d '"' -f 2)
          NAME=$(grep '^name' pyproject.toml | cut -d '"' -f 2)
          echo "ğŸ“¦ æ’ä»¶: $NAME"
          echo "ğŸ”– ç‰ˆæœ¬: $VERSION"
          echo ""
          echo "ğŸŒ æŸ¥çœ‹åœ°å€: https://registry.comfy.org/nodes/easykit-node-align"
          echo ""
          echo "ğŸ’¡ ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡ ComfyUI Manager æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬"
          echo "========================================"
          echo ""
          echo "ğŸ“Œ æ³¨æ„: æ­¤å‘å¸ƒç”± pyproject.toml ç‰ˆæœ¬æ›´æ–°è‡ªåŠ¨è§¦å‘"
      
      - name: Failure Notification
        if: failure()
        run: |
          echo "========================================"
          echo "âŒ è‡ªåŠ¨å‘å¸ƒå¤±è´¥!"
          echo "========================================"
          echo ""
          echo "âš ï¸  æ’ä»¶å‘å¸ƒåˆ° ComfyUI Registry å¤±è´¥"
          echo ""
          echo "è¯·æ£€æŸ¥ä»¥ä¸‹å¯èƒ½åŸå› :"
          echo "1. API Token æ˜¯å¦æ­£ç¡®æˆ–å·²è¿‡æœŸ"
          echo "2. ç‰ˆæœ¬å·æ˜¯å¦å·²å­˜åœ¨"
          echo "3. pyproject.toml é…ç½®æ˜¯å¦æ­£ç¡®"
          echo ""
          echo "ğŸ”§ è§£å†³æ–¹æ¡ˆ:"
          echo "- æ£€æŸ¥å¹¶æ›´æ–° API Token"
          echo "- ä¿®æ”¹ pyproject.toml ä¸­çš„ç‰ˆæœ¬å·"
          echo "- é‡æ–°æäº¤åˆ° main åˆ†æ”¯"
          echo ""
          echo "æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—è¯·è®¿é—® GitHub Actions é¡µé¢"
          echo "========================================"